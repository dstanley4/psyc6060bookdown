---
output:
  pdf_document: default
  html_document: default
---

# Deeper dive sampling [under construction]

## Previously: Equal Population Means

In the last chapter, we examined the scenario where there was distribution of sample means where the sample means differed due to random sampling only. We created a scenario where the sample means differed to random sampling only when we created three populations with identical means (and variances). This situation is depicted in the scenario below.

```{r sim3poprepeat, out.width = "100%", echo=FALSE, fig.cap= "Sampling from three populations with the same mean (and variance)"}
knitr::include_graphics("ch_deeper_sampling/images/pop_equal_means.png")
```

| Population |  Mean        | Variance        |
|:----------:|:------------:|:----------------|
| 1          | $\mu_{A1_{people}}= 172.50$ |  $\sigma_{1_{people}}^2= 156.3236$ |
| 2          | $\mu_{A2_{people}}= 172.50$ |  $\sigma_{2_{people}}^2= 156.3236$ |
| 3          | $\mu_{A3_{people}}= 172.50$ |  $\sigma_{3_{people}}^2= 156.3236$ |

### Mean of population means (equal $\mu$)

We can think of there mean a mean of the population means:

$$
\begin{aligned} 
\mu_{\mu_A} &=  \frac{\sum{\mu_A}}{A} \\
&=  \frac{\mu_{A1}+\mu_{A2}+\mu_{A3}}{A} \\
&=  \frac{172.50 + 172.50 + 172.50}{3} \\
&= \frac{517.50}{3}\\
&= 172.50 \\
\end{aligned}
$$

### Population means:  Variance (equal $\mu$)

$$
\begin{aligned} 
\sigma_{\mu_A}^2 &=  \frac{\sum (\mu_{A_i}-\mu_{\mu_A})^2}{A} \\
&=  \frac{(\mu_{A_1} - \mu_{\mu_A})^2 + (\mu_{A_2} - \mu_{\mu_A})^2 + (\mu_{A_3} - \mu_{\mu_A})^2}{3} \\
&=  \frac{(172.50 - 172.50)^2 + (172.50 - 172.50)^2 + (172.50 - 172.50)^2}{3} \\
&=  \frac{0}{3} \\
&=  0\\
\end{aligned}
$$

### Sample means: Sampling error variance (equal $\mu$)

$$
\begin{aligned} 
\frac{\sigma_{people}^2}{n} &= \frac{156.3236}{5}\\
&= 31.26472\\
\end{aligned}
$$

### Sample means: Overall variance (equal $\mu$)

$$
\begin{aligned} 
\sigma_{\bar{x}}^2 &= \text{Variance from random sampling} + \text{Variance in population means} 
&= \frac{\sigma_{people}^2}{n} + \sigma_{\mu_A}^2\\
&= \frac{156.3236}{5} + 0\\
&= 31.26472 + 0\\
&= 31.26472\\
\end{aligned} 
$$


### Simulation: Overall variance (equal $\mu$)

```{r, echo=FALSE}
set.seed(1234)
```

```{r}
library(tidyverse)
library(learnSampling)

pop1 <- make_population(mean = 172.50, variance = 156.3236)
pop2 <- pop1
pop3 <- pop1


data_ratios3 <- get_mean_samples_ratio(pop1, pop2, pop3,
                                      number.of.trials = 1000)


```


We created a data set called many_samples that has many sample means in it.

You can see the first rows of many_samples with the command below.

```{r}
head(many_samples)
```

We can calculate the variance of the sample_mean column using the var() command.

```{r}
many_samples %>% 
  summarise(var_sample_means = var(sample_mean)) %>% 
  as.data.frame()
```



## Now: Unequal Population Means



```{r sim3poprepeatunequal, out.width = "100%", echo=FALSE, fig.cap= "Sampling from three populations with the same mean (and variance)"}
knitr::include_graphics("ch_deeper_sampling/images/pop_unequal_means.png")
```


| Population |  Mean        | Variance        |
|:----------:|:------------:|:----------------|
| 1          | $\mu_{A1_{people}}= 152.50$ |  $\sigma_{1_{people}}^2= 156.3236$ |
| 2          | $\mu_{A2_{people}}= 172.50$ |  $\sigma_{2_{people}}^2= 156.3236$ |
| 3          | $\mu_{A3_{people}}= 192.50$ |  $\sigma_{3_{people}}^2= 156.3236$ |



### Mean of population means (unequal $\mu$)

We can think of there mean a mean of the population means:

$$
\begin{aligned} 
\mu_{\mu_A} &=  \frac{\sum{\mu_A}}{A} \\
&=  \frac{\mu_{A1}+\mu_{A2}+\mu_{A3}}{A} \\
&=  \frac{152.50 + 172.50 + 192.50}{3} \\
&= \frac{517.50}{3}\\
&= 172.50 \\
\end{aligned}
$$

### Population means:  Variance (unequal $\mu$)

$$
\begin{aligned} 
\sigma_{\mu_A}^2 &=  \frac{\sum (\mu_{A_i}-\mu_{\mu_A})^2}{A} \\
&=  \frac{(\mu_{A_1} - \mu_{\mu_A})^2 + (\mu_{A_2} - \mu_{\mu_A})^2 + (\mu_{A_3} - \mu_{\mu_A})^2}{3} \\
&=  \frac{(152.50 - 172.50)^2 + (172.50 - 172.50)^2 + (192.50 - 172.50)^2}{3} \\
&=  \frac{(-20)^2 + (0)^2 + (20)^2}{3} \\
&=  \frac{400 + 0 + 400}{3} \\
&=  \frac{800}{3} \\
&=  266.6667\\
\end{aligned}
$$

### Sample means: Sampling error variance (unequal $\mu$)

$$
\begin{aligned} 
\frac{\sigma_{people}^2}{n} &= \frac{156.3236}{5}\\
&= 31.26472\\
\end{aligned}
$$

### Sample means: Overall variance (unequal $\mu$)

$$
\begin{aligned} 
\sigma_{\bar{x}}^2 &= \frac{\sigma_{people}^2}{n} + \sigma_{\mu_A}^2\\
&= \frac{156.3236}{5} + 266.6667\\
&= 31.26472 + 266.6667\\
&= 297.9314\\
\end{aligned} 
$$


##  Summary


|          Attribute           |                                  Parameter Calculation                                   |                               Estimate of Parameter                               | Reflects         |
|:----------------------------:|:----------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------:|:----------------:|
|      Method 1: Variance      |  $\sigma_{\bar{x}}^2 = \frac{\sum_{i=1}^{K=\infty}{(\bar{x}_i - \mu_{\bar{x}})^2}}{K}$   |    $s_{\bar{x}}^2 = \frac{\sum_{i=1}^{a}{(\bar{x}_i - \bar{\bar{x}})^2}}{a-1}$    | Sampling Error & Variance of Population Means |
|    Method 2 CLT: Variance    |                    $\sigma_{\bar{x}}^2 = \frac{\sigma_{people}^2}{n}$                    |                     $s_{\bar{x}}^2 = \frac{s_{people}^2}{n}$                      | Just Sampling Error |

